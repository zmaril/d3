<!DOCTYPE html>  <html> <head>   <title>map.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               map.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This whole file started out as a way to become backwards compatible with older js engines. 
See this <a href="https://github.com/mbostock/d3/commit/738b6347898aa7789936bfac8e5973f5f2768e3d">commit</a> for more information. 
The main worry seemed to be that there would be collisions between added properties and built-in property names such as <code>__proto__</code> and <code>hasOwnProperty</code>. 
Over time it is being <a href="https://github.com/mbostock/d3/commit/ebab983b8a644b4e5a7fe3d392be67d44c3e900b">integrated</a> <a href="https://github.com/mbostock/d3/commit/7069da0c79d3c7e1578e5a6df5c1bc1e2e539faa">further</a> and <a href="https://github.com/mbostock/d3/commit/f1197ed8b6b4893237cdd3e27e7454af3c97a612">further</a> into d3.js as the way to store maps of values. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The basics map object. It takes in an object and copies over all of the key-values into a new map. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">d3</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">d3_Map</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="nx">map</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
  <span class="k">return</span> <span class="nx">map</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Below is a class definition for d3_Map. It uses <a href="http://localhost:8000/class.html"><code>d3_class</code></a> to define a custom object that is built to prevent collisions. By using a custom prefix code for keys for the map, the object can prevent collisions without much extra work. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Create the initial object. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">d3_Map</span><span class="p">()</span> <span class="p">{}</span>

<span class="nx">d3_class</span><span class="p">(</span><span class="nx">d3_Map</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Boolean function that tells whether or not the key is in the map. </p>

<pre><code>        d3.map({a:1}).has('a') == true
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>             
  <span class="nx">has</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">d3_map_prefix</span> <span class="o">+</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Returns the value of the key. </p>

<pre><code>        d3.map({a:1}).get('a') == 1
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">d3_map_prefix</span> <span class="o">+</span> <span class="nx">key</span><span class="p">];</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Returns the value of the key. </p>

<pre><code>        m = d3.map({a:1})
        m.get("a")==1
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">d3_map_prefix</span> <span class="o">+</span> <span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Removes a key-value pair from the map. Note the use of 'key in this &amp;&amp;' to check for the key. If it is found then, use the delete keyword. </p>

<pre><code>        m = d3.map({a:1})
        m.remove("a")
        m.get("a") == null
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">key</span> <span class="o">=</span> <span class="nx">d3_map_prefix</span> <span class="o">+</span> <span class="nx">key</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span> <span class="o">&amp;&amp;</span> <span class="k">delete</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Collect all the keys from the map. </p>

<pre><code>        m = d3.map({a:1, b:2, c:1})
        m.keys() == ["a","b","c"]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">keys</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span> <span class="p">});</span>
    <span class="k">return</span> <span class="nx">keys</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Collect all of the values from the map. The values aren't necessarily unique like the keys. </p>

<pre><code>        m = d3.map({a:1, b:2, c:1})
        m.values() == [1,2,1]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">values</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="nx">values</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="p">});</span>
    <span class="k">return</span> <span class="nx">values</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Collect all of the key-value pairs from the map. </p>

<pre><code>        m = d3.map({a:1, b:2, c:1})
        m.entries() == [{key:"a", value: 1},{key:"b", value: 2},{key:"c", value: 1}]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">entries</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">entries</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">key</span><span class="o">:</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">value</span><span class="p">});</span> <span class="p">});</span>
    <span class="k">return</span> <span class="nx">entries</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Given a function, calls the function for each entry in the map. Does not change the map. </p>

<pre><code>        m = d3.map({a:1, b:2, c:1})
        m.forEach(function(key,value){return value+1;})
        m.get("a") == 1

        q = d3.map()
        m.forEach(function(key,value){q.set(key,value+1);})
        q.get("a")==2
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">forEach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="nx">d3_map_prefixCode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>The code that prevents collisions from happening within the code. Used to prefix all of the keys when they are being inserted into the map. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">d3_map_prefix</span> <span class="o">=</span> <span class="s2">&quot;\0&quot;</span><span class="p">,</span> <span class="c1">// prevent collision with built-ins</span>
    <span class="nx">d3_map_prefixCode</span> <span class="o">=</span> <span class="nx">d3_map_prefix</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 