<!DOCTYPE html>
<html><head><title>zmaril/d3 » src › layout › bundle.js

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>bundle.js</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>Implements hierarchical edge bundling using Holten's algorithm. For each
input link, a path is computed that travels through the tree, up the parent
hierarchy to the least common ancestor, and then back down to the destination
node. Each path is simply an array of nodes.</p></td><td class="code"><div class="highlight"><pre><span class="nx">d3</span><span class="p">.</span><span class="nx">layout</span><span class="p">.</span><span class="nx">bundle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">links</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">paths</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="nx">n</span> <span class="o">=</span> <span class="nx">links</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">)</span> <span class="nx">paths</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">d3_layout_bundlePath</span><span class="p">(</span><span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
    <span class="k">return</span> <span class="nx">paths</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">d3_layout_bundlePath</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span>
      <span class="nx">end</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span>
      <span class="nx">lca</span> <span class="o">=</span> <span class="nx">d3_layout_bundleLeastCommonAncestor</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">),</span>
      <span class="nx">points</span> <span class="o">=</span> <span class="p">[</span><span class="nx">start</span><span class="p">];</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">start</span> <span class="o">!==</span> <span class="nx">lca</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">start</span> <span class="o">=</span> <span class="nx">start</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
    <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">start</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">end</span> <span class="o">!==</span> <span class="nx">lca</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">points</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
    <span class="nx">end</span> <span class="o">=</span> <span class="nx">end</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">points</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">d3_layout_bundleAncestors</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">ancestors</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">parent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">parent</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ancestors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="nx">node</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
    <span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">ancestors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">ancestors</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">d3_layout_bundleLeastCommonAncestor</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">aNodes</span> <span class="o">=</span> <span class="nx">d3_layout_bundleAncestors</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span>
      <span class="nx">bNodes</span> <span class="o">=</span> <span class="nx">d3_layout_bundleAncestors</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span>
      <span class="nx">aNode</span> <span class="o">=</span> <span class="nx">aNodes</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span>
      <span class="nx">bNode</span> <span class="o">=</span> <span class="nx">bNodes</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span>
      <span class="nx">sharedNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">aNode</span> <span class="o">===</span> <span class="nx">bNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sharedNode</span> <span class="o">=</span> <span class="nx">aNode</span><span class="p">;</span>
    <span class="nx">aNode</span> <span class="o">=</span> <span class="nx">aNodes</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
    <span class="nx">bNode</span> <span class="o">=</span> <span class="nx">bNodes</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">sharedNode</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"zmaril/d3",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
